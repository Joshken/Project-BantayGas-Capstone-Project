<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BANTAYGAS - Sign In</title>
    <link rel="stylesheet" href="../CSS/login.css">
</head>
<body>
    <div class="login-card">
        <div class="logo-section">
            <div class="logo">
                <img src="../Logos and BG/bantaygas-logo.png" alt="BANTAYGAS Logo" style="width: 120%; height: 120%; object-fit: contain;">
            </div>
            <div class="brand-name">BANTAYGAS</div>
        </div>

        <h2 class="signin-heading">Sign In</h2>

        <form>
            <div class="form-group">
                <input type="email" id="email" name="email" class="form-input" placeholder="Email" required>
            </div>

            <div class="form-group">
                <input type="password" id="password" name="password" class="form-input" placeholder="Password" required>
            </div>

            <div class="forgot-password">
                <a href="forgot-password.html">Forgot your password?</a>
            </div>

            <button type="submit" class="signin-btn">Sign in</button>
        </form>
        
        <!-- Debug Test Button -->
        <div style="margin-top: 20px; text-align: center;">
            <button type="button" onclick="testLogin()" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                Test Login (Auto-fill)
            </button>
        </div>

        <div class="divider">
            <span>Or</span>
        </div>

        <div class="social-login">
            <a href="#" class="social-btn google-btn">
                <img src="../Logos and BG/google.png" alt="Google" style="width: 24px; height: 24px; object-fit: contain;">
            </a>
            <a href="#" class="social-btn facebook-btn">
                <img src="../Logos and BG/facebook.png" alt="Facebook" style="width: 24px; height: 24px; object-fit: contain;">
            </a>
        </div>

        <div class="signup-section">
            <span>Dont have an account.</span>
            <a href="sign-up.html">Sign Up</a>
        </div>
    </div>

    <script src="../JS/backend.js"></script>
    <script>
        // Temporary account credentials (fallback)
        const TEMP_ACCOUNT = {
            email: 'baguiojosh@gmail.com',
            password: '123'
        };

        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Login page loaded');
            
            // Handle form submission
            const form = document.querySelector('form');
            if (form) {
                form.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const email = document.getElementById('email').value.trim();
                    const password = document.getElementById('password').value.trim();
                    
                    console.log('Login attempt:', { email, password });
                    
                    // Show loading state
                    const submitBtn = document.querySelector('.signin-btn');
                    const originalText = submitBtn.textContent;
                    submitBtn.textContent = 'Signing in...';
                    submitBtn.disabled = true;
                    
                    try {
                        // Try backend login first
                        const result = await api.login(email, password);
                        
                        if (result.status === 'success') {
                            console.log('Backend login successful');
                            window.location.href = 'monitoring.html';
                        } else {
                            throw new Error(result.message || 'Login failed');
                        }
                    } catch (error) {
                        console.log('Backend login failed, trying fallback:', error);
                        
                        // Fallback to temporary account
                        if (email === TEMP_ACCOUNT.email && password === TEMP_ACCOUNT.password) {
                            console.log('Fallback login successful');
                            
                            // Store login status in sessionStorage
                            sessionStorage.setItem('isLoggedIn', 'true');
                            sessionStorage.setItem('userEmail', email);
                            sessionStorage.setItem('userName', 'Josh Baguio');
                            sessionStorage.setItem('userRole', 'Admin');
                            
                            // Redirect to monitoring page
                            window.location.href = 'monitoring.html';
                        } else {
                            console.log('Login failed - credentials mismatch');
                            alert('Invalid email or password. Please try again.\n\nTemporary Account:\nEmail: baguiojosh@gmail.com\nPassword: 123');
                        }
                    } finally {
                        // Reset button state
                        submitBtn.textContent = originalText;
                        submitBtn.disabled = false;
                    }
                });
            } else {
                console.error('Form not found');
            }

            // Check if user is already logged in
            if (sessionStorage.getItem('isLoggedIn') === 'true') {
                console.log('User already logged in, redirecting...');
                window.location.href = 'monitoring.html';
            }
        });
        
        // Test function for debugging
        window.testLogin = function() {
            document.getElementById('email').value = 'baguiojosh@gmail.com';
            document.getElementById('password').value = '123';
            console.log('Test credentials filled');
        };
    </script>
</body>
</html>
